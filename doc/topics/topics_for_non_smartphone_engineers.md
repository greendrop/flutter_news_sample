# 非スマホエンジニア向けのトピック

## スマホ・スマホアプリの状態

スマホ・スマホアプリの状態はいくつかある。

### スマホ本体の状態

- OS 状態
  - OS
  - バージョン
- 電源状態
  - オン
  - オフ
  - スリープ
- バッテリー状態
  - 使用中
  - 充電中
  - 充電完了
  - 低電力モード
  - バッテリー切れ
- 通信状態
  - Wi-Fi 接続
  - モバイルデータ通信
  - 機内モード
  - オフライン
- ストレージ状態
  - ストレージ容量
  - 空き容量あり
  - 空き容量なし

### スマホアプリの状態

- インストール状態
  - 未インストール
  - インストール済
- 実行状態
  - 実行中（フォアグラウンド）
  - バックグラウンド実行
  - 停止（Kill）
- 更新状態
  - 最新版
  - アップデート可能
  - アップデート不可
- 権限状態
  - 必要な権限が付与されている
  - 一部の権限が拒否されている
  - すべての権限が拒否されている
- データ状態
  - データが同期されている
  - データが同期されていない
  - データが破損している
- エラー状態
  - クラッシュ
  - フリーズ
  - エラーメッセージが表示される

## スマホアプリの画面遷移について

スマホアプリで次の画面へ遷移したり、前の画面に戻るような内容はスタックで管理されている。

参考: https://codezine.jp/article/detail/14271

## 通知について

通知には、大きく分けて「ローカル通知」と「プッシュ通知」の 2 種類がある。

## ローカル通知

- スマホアプリ自体で 即時 または 決められた時間 に通知を表示ができる
- 決められた時間に通知する場合、その設定でメッセージも指定するため、柔軟にメッセージを変更することはできない
- オフラインでも通知を表示ができる
- サーバーが不要

## プッシュ通知

- サーバーから通知内容を受け取り、通知を表示できる
- サーバーから通知内容を送信するため、柔軟にメッセージ・タイミングを変更できる
- iOS は APNs(Apple Push Notification service)、Android は FCM(Firebase Cloud Messaging)で送信する
  - FCM 経由で APNs へ送信することも可能
  - サードパーティのサービスもある
    - [Amazon Simple Notification Service](https://aws.amazon.com/jp/sns/)
    - [OneSignal](https://onesignal.com/)
    - [Repro]https://repro.io/
    - など
- プッシュ通知の中でも、通知を表示する「通知メッセージ」とデータのみの「データメッセージ」に分かれる。

### 通知メッセージ

- バックグラウンド実行・停止（Kill）
  - 受け取った通知内容をもとに通知に表示される
- フォアグラウンド
  - 自動で通知は表示されない
  - スマホアプリで通知を受け取ったことを検知し、ローカル通知により通知へ表示ができる

### データメッセージ

- データを受け取り、スマホアプリにて処理を行うことができる
- FCM 経由で APNs に送信した場合、サイレントプッシュ通知として扱われる
  - 実行可能時間は 30 秒
  - ユーザーによって明示的に停止（Kill）されてなければ実行可能

# URL によるスマホアプリ起動について

Web ページ内やメール文章内のリンクからスマホアプリを起動することができる。

## カスタムスキーマ

- `myapp:://` のようにスマホアプリ独自のカスタムスキーマ設定することができる
- そのカスタムスキーマを指定したリンクを作成しそれをクリックすると、スマホアプリが起動する
- スマホアプリがインストールされていない場合、なにも動作しない
- カスタムスキーマは自由に設定できるため、乗っ取り攻撃のセキュリティーリスクがある
  - 例: https://developers.line.biz/ja/news/2020/03/25/line-url-scheme-deprecation/

## Universal Links (iOS)

- `https://myapp.example.com` のような特定の URL でスマホアプリが起動できる
- `https://myapp.example.com/.well-known/apple-app-site-association` に設定を記載したファイルを配置しなければならない

## App Links (Android)

- `https://myapp.example.com` のような特定の URL でスマホアプリが起動できる
- `https://myapp.example.com/.well-known/assetlinks.json` に設定を記載したファイルを配置しなければならない

## サードパーティのサービス

サードパーティのサービスを利用することで、スマホアプリ起動の URL が用意でき、スマホアプリがインストールされていない場合は App Store, Play Store を開くことができる。

- [Firebase Dynamic Links](https://firebase.google.com/docs/dynamic-links?hl=ja) (2025/08/25 サービス終了)
- [Adjust](https://www.adjust.com/ja/)
- [AppsFlyer](https://www.appsflyer.com/ja/)
